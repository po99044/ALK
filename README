# Functional atlas of ALK kinase domain variants – analysis code

This repository contains custom Python code used to process amplicon NGS data and to reproduce downstream analyses/figures for the manuscript:
**"A comprehensive functional atlas of ALK kinase domain variants reveals resistance landscape to ALK inhibitor"**.

## Overview of pipeline
1. **FASTQ parsing and trimmed read counting (custom code)**  
   Amplicon FASTQ reads are scanned for a forward-primer seed (first 10 nt of the exon reference), and a fixed-length sequence segment is extracted and counted. Indel-length reads are excluded by enforcing the expected length.

2. **Variant-level count table generation (custom code)**  
   Trimmed read counts are mapped onto library barcode tables (e.g., `ALK_E23_aa.csv`) and exported as count matrices.

3. **Downstream analyses**  
   Additional scripts compute RPM/log2 fold-change and support analysis/figure generation for drug resistance and ALK dependence.

## Installation
### Option A: conda (recommended)
```bash
conda env create -f environment.yml
conda activate alk-variant-atlas


Usage
1) FASTQ → count table

python scripts/01_fastq_to_counts.py \
  --exon 23 \
  --barcode_csv path/to/ALK_E23_aa.csv \
  --sample D10_R1=/path/to/E23R1D10.extendedFrags.fastq \
  --sample D10_R2=/path/to/E23R2D10.extendedFrags.fastq \
  --sample REF=/path/to/H3122_E23.extendedFrags.fastq \
  --sample A=/path/to/23R2A.extendedFrags.fastq \
  --sample L=/path/to/23R2L.extendedFrags.fastq \
  --sample T=/path/to/23R2T.extendedFrags.fastq \
  --sample U=/path/to/23R2U.extendedFrags.fastq \
  --out results/ALK_E23_R2_D21_counts.csv


2) Count table → RPM/LFC

python scripts/02_compute_rpm_lfc.py \
  --in results/ALK_E23_R2_D21_counts.csv \
  --baseline U \
  --cols A L T U \
  --out results/ALK_E23_R2_D21_rpm_lfc.csv


3) Example figure

python scripts/06_alk_drug_figures.py \
  --coverage_csv Result/Coverage_SNV.csv \
  --outdir figures/drug




License

This repository is released under an OSI-compliant open-source license (see LICENSE).

Citation

If you use this code, please cite the GitHub repository and the archived Zenodo release (DOI), as described in the manuscript.
